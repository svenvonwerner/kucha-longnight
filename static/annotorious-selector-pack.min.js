/*! For license information please see annotorious-selector-pack.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(function(){return(()=>{var e={94:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,a;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(a=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,a[i]))return!1;for(i=o;0!=i--;){var u=a[i];if(!e(n[u],r[u]))return!1}return!0}return n!=n&&r!=r}},773:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{default:()=>cn});var e,t=n(773),o=n.n(t),i="http://www.w3.org/2000/svg",a=function(e,t){var n=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set}(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))},u=new Uint8Array(16);function c(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(u)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&l.test(e)};for(var f=[],p=0;p<256;++p)f.push((p+256).toString(16).substr(1));const d=function(e,t,n){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var y=n(94),b=n.n(y);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"clone",(function(t,n){return new e(g(g({},r.underlying),t),g(g({},r.opts),n))})),m(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n}var t,n;return t=e,(n=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&b()(this.underlying,e.underlying))}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"start",get:function(){return this.selector("TextPositionSelector").start}},{key:"end",get:function(){return this.selector("TextPositionSelector").end}}])&&v(t.prototype,n),e}();function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}m(w,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(d()),body:[]};return new w(g(g({},t),e))}));var j=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),E(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=O(O({},n.underlying),t)),n})),E(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),E(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(d())});return new w(e)})),this.underlying={type:"Selection",body:n||[],target:t}}var t,n;return t=e,(n=[{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&b()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"isSelection",get:function(){return!0}}])&&A(t.prototype,n),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},M(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var o=T(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _(this,n)}}function _(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return G(e)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N="An implementation is missing",H="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,L=function(e){C(n,e);var t=R(n);function n(e,r,o){var a;return k(this,n),D(G(a=t.call(this)),"getSVGPoint",(function(e){var t=a.svg.createSVGPoint();if(H){var n=a.svg.getBoundingClientRect(),r=e.clientX-n.x,o=e.clientY-n.y,i=a.svg.getBoundingClientRect(),u=i.left,c=i.top;return t.x=r+u,t.y=o+c,t.matrixTransform(a.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(a.g.getCTM().inverse())})),D(G(a),"drawHandle",(function(e,t){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),o=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r},u=a.config.handleRadius||6,c=o(u);c.setAttribute("class","a9s-handle-inner");var l=o(u+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),D(G(a),"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n);var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n)})),D(G(a),"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),D(G(a),"scaleHandles",(function(e){var t;null===(t=a.handles)||void 0===t||t.forEach((function(t){var n=t.querySelector(".a9s-handle-inner"),r=t.querySelector(".a9s-handle-outer"),o=e*(a.config.handleRadius||6);n.setAttribute("r",o),r.setAttribute("r",o)}))})),a.svg=e.closest("svg"),a.g=e,a.config=r,a.env=o,a}return n}(o()),B=function(e){C(o,e);var t,n,r=R(o);function o(e,t,n){var i;return k(this,o),D(G(i=r.call(this,e,t,n)),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(i.mouseMove=function(e){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),t(r,o,e)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(e){if(0===e.button){var t=i.getSVGPoint(e),r=t.x,o=t.y;n(r,o,e)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(e){var t=i.getSVGPoint(e),n=t.x,o=t.y;r(n,o,e)},document.addEventListener("dblclick",i.dblClick))})),D(G(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),D(G(i),"start",(function(e){var t=i.getSVGPoint(e),n=t.x,r=t.y;i.startDrawing(n,r,e)})),D(G(i),"startDrawing",(function(e){throw new Error(N)})),D(G(i),"createEditableShape",(function(e){throw new Error(N)})),i.started=!1,i}return t=o,(n=[{key:"isDrawing",get:function(){throw new Error(N)}}])&&x(t.prototype,n),o}(L);B.supports=function(e){throw new Error(N)};var U=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},X=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,a=r.value,u=o.parseFromString(a,"image/svg+xml"),c=u.lookupPrefix(i),l=u.lookupNamespaceURI(null);return c||l?U(u).firstChild:U((t=u,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},q=function(e){var t=X(e),n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Y=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},F=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},z=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");F(o,t,n,r),F(i,t,n,r)},V=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,"redraw",(function(){var e=V(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,a=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(a," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),W(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=V(this.circle),a=o.cx,u=o.cy,c=o.r,l=a+c>this.w?this.w-c:a,s=u+c>this.h?this.h-c:u+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&I(t.prototype,n),e}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=function(){function e(t,n,r,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K(this,"dragTo",(function(e,t){var n=a.env.image,r=n.naturalWidth,o=n.naturalHeight;a.group.style.display=null;var i=e-a.anchor[0],u=t-a.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(u,2),.5)/2),l=a.anchor[0]+i/2,s=a.anchor[1]+u/2;l-c<0||l+c>r||s-c<0||s+c>o||(z(a.circle,l,s,c),a.mask.redraw())})),K(this,"getBoundingClientRect",(function(){return a.circle.getBoundingClientRect()})),K(this,"toSelection",(function(){return new j(Y(a.group,a.env.image))})),K(this,"destroy",(function(){a.group.parentNode.removeChild(a.group),a.mask=null,a.circle=null,a.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(e,t,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),a=document.createElementNS(i,"circle");return a.setAttribute("class","a9s-inner"),F(a,e,t,2),o.setAttribute("class","a9s-outer"),F(o,e,t,2),r.appendChild(o),r.appendChild(a),r}(t,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new Z(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.circle}}])&&$(t.prototype,n),e}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t){return te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e,t){if(t&&("object"===Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return re(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ae="An implementation is missing",ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=oe(r);if(o){var n=oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ne(this,e)});function a(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),ie(re(o=i.call(this,t,n,r)),"enableResponsive",(function(){window.ResizeObserver&&(o.resizeObserver=new ResizeObserver((function(){var e=o.svg.getBoundingClientRect(),t=o.svg.viewBox.baseVal,n=t.width,r=t.height,i=Math.max(n/e.width,r/e.height);o.scaleHandles(i)})),o.resizeObserver.observe(o.svg.parentNode))})),ie(re(o),"updateState",(function(e){throw new Error(ae)})),o.annotation=e,o.handles=[];var u=r.image;return(u instanceof Element||u instanceof HTMLDocument)&&o.enableResponsive(),o}return t=a,(n=[{key:"element",get:function(){throw new Error(ae)}},{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}])&&ee(t.prototype,n),a}(L),ce=/firefox/i.test(navigator.userAgent),le=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),ce?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},se=function(e,t){var n=t.getBBox(),r=n.x,o=n.y,a=n.width,u=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),le(c,r,o,a,u);var l=document.createElementNS(i,"g");l.appendChild(e),c.appendChild(l),t.append(c)},fe=function(e,t,n){if(!n)return e;var r=n(t);if(!r)return e;if("string"==typeof r||r instanceof String)a(e,r);else if(r.nodeType===Node.ELEMENT_NODE)se(r,e);else{var o=r.className,i=r.style,u=r.element;if(o&&a(e,o),i){var c=e.querySelector(".a9s-outer"),l=e.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",i)):e.setAttribute("style",i)}for(var s in u&&se(u,e),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&e.setAttribute(s,r[s])}},pe=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&le(i,t,n,r,o)};function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t,n){return ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Se(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ge(e,t,n||e)}function ve(e,t){return ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ve(e,t)}function me(e,t){if(t&&("object"===de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return we(e)}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(r);if(o){var n=Se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return me(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Oe(we(o=a.call(this,e,t,n,r)),"setSize",(function(e,t,n){z(o.circle,e,t,n),o.mask.redraw(),pe(o.elementGroup,e,t,n,n);var r=ye(o.handles,4),i=r[0],a=r[1],u=r[2],c=r[3];o.setHandleXY(i,e,t-n),o.setHandleXY(a,e+n,t),o.setHandleXY(u,e,t+n),o.setHandleXY(c,e-n,t)})),Oe(we(o),"stretchCorners",(function(e,t,n){var r,i=o.getHandleXY(t),a=n.x,u=n.y,c=0,l=0;0==e||2==e?(a=i.x,l=u-i.y,r=Math.abs(l)/2):(u=i.y,c=a-i.x,r=Math.abs(c)/2);var s=c>0?i.x:a,f=l>0?i.y:u,p=s+Math.abs(c)/2,d=f+Math.abs(l)/2;if(z(o.circle,p,d,r),o.mask.redraw(),pe(o.elementGroup,p,d,r,r),0==e||2==e){var y=0,b=2;(0==e&&l>0||2==e&&l<0)&&(y=2,b=0),o.setHandleXY(o.handles[y],p,d-r),o.setHandleXY(o.handles[b],p,d+r),o.setHandleXY(o.handles[1],p+r,d),o.setHandleXY(o.handles[3],p-r,d)}else{var h=3,g=1;(1==e&&c>0||3==e&&c<0)&&(h=1,g=3),o.setHandleXY(o.handles[h],p+r,d),o.setHandleXY(o.handles[g],p-r,d),o.setHandleXY(o.handles[0],p,d-r),o.setHandleXY(o.handles[2],p,d+r)}})),Oe(we(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=V(o.circle),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),Oe(we(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.circle){var r=V(o.circle).r,i=o.env.image,a=i.naturalWidth,u=i.naturalHeight,c=Math.max(t(n.x-o.grabbedAt.x,a-r),r),l=Math.max(t(n.y-o.grabbedAt.y,u-r),r);o.setSize(c,l,r),o.emit("update",Y(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",Y(o.circle,o.env.image))}}})),Oe(we(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Oe(we(o),"updateState",(function(e){var t=X(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.circle=q(e),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new Z(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=V(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(e){var t=ye(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),fe(o.circle,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ge(Se(u.prototype),"destroy",this).call(this)}}])&&he(t.prototype,n),u}(ue);function Ee(e){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ee(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e,t){return Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Pe(e,t)}function xe(e,t){if(t&&("object"===Ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ke(e)}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ce(r);if(o){var n=Ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return xe(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Me(ke(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new J(e,t,r.g,r.env)})),Me(ke(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Me(ke(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),Me(ke(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),Me(ke(r),"createEditableShape",(function(e){return new Ae(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&je(t.prototype,n),a}(B);Re.identifier="circle",Re.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var _e=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},Ge=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),a=e.querySelector(".a9s-outer");_e(i,t,n,r,o),_e(a,t,n,r,o)},Te=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var He=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ne(this,"redraw",(function(){var e=Te(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,a=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(a," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),Ne(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=Te(this.ellipse),a=o.cx,u=o.cy,c=o.rx,l=o.ry,s=u+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(a," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&De(t.prototype,n),e}();function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ue=function(){function e(t,n,r,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Be(this,"dragTo",(function(e,t){a.group.style.display=null;var n=e-a.anchor[0],r=t-a.anchor[1],o=n>0?a.anchor[0]+n/2:e+n/2,i=r>0?a.anchor[1]+r/2:t+r/2,u=Math.abs(n/2),c=Math.abs(r/2);Ge(a.ellipse,o,i,u,c),a.mask.redraw()})),Be(this,"getBoundingClientRect",(function(){return a.ellipse.getBoundingClientRect()})),Be(this,"toSelection",(function(){return new j(Y(a.group,a.env.image))})),Be(this,"destroy",(function(){a.group.parentNode.removeChild(a.group),a.mask=null,a.ellipse=null,a.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(e,t,n,r){var o=document.createElementNS(i,"g"),a=document.createElementNS(i,"ellipse"),u=document.createElementNS(i,"ellipse");return a.setAttribute("class","a9s-inner"),_e(a,e,t,2,r),u.setAttribute("class","a9s-outer"),_e(u,e,t,2,r),o.appendChild(u),o.appendChild(a),o}(t,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new He(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.ellipse}}])&&Le(t.prototype,n),e}();function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ze(e,t,n){return ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ze(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ze(e,t,n||e)}function Ve(e,t){return Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ve(e,t)}function Ie(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return We(e)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ze(e){return Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ze(e)}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ze(r);if(o){var n=Ze(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ie(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),$e(We(o=a.call(this,e,t,n,r)),"setSize",(function(e,t,n,r){Ge(o.ellipse,e,t,n,r),o.mask.redraw(),pe(o.elementGroup,e,t,n,r);var i=qe(o.handles,4),a=i[0],u=i[1],c=i[2],l=i[3];o.setHandleXY(a,e,t-r),o.setHandleXY(u,e+n,t),o.setHandleXY(c,e,t+r),o.setHandleXY(l,e-n,t)})),$e(We(o),"stretchCorners",(function(e,t,n,r){var i=o.getHandleXY(t),a=o.getHandleXY(n),u=r.x,c=r.y,l=0,s=0;0==e||2==e?u=i.x:c=i.y;var f=u-i.x,p=c-i.y,d=f>0?i.x:u,y=p>0?i.y:c,b=Math.abs(f),h=Math.abs(p),g=d+b/2,v=y+h/2;if(l=b/2,s=h/2,0==e||2==e?l=Math.abs(i.x-a.x):s=Math.abs(i.y-a.y),Ge(o.ellipse,g,v,l,s),o.mask.redraw(),pe(o.elementGroup,g,v,l,s),0==e||2==e){var m=0,w=2;(0==e&&p>0||2==e&&p<0)&&(m=2,w=0),o.setHandleXY(o.handles[m],g,v-s),o.setHandleXY(o.handles[w],g,v+s),o.setHandleXY(o.handles[1],g+l,v),o.setHandleXY(o.handles[3],g-l,v)}else{var S=3,O=1;(1==e&&f>0||3==e&&f<0)&&(S=1,O=3),o.setHandleXY(o.handles[S],g+l,v),o.setHandleXY(o.handles[O],g-l,v),o.setHandleXY(o.handles[0],g,v-s),o.setHandleXY(o.handles[2],g,v+s)}})),$e(We(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=Te(o.ellipse),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),$e(We(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.ellipse){var r=Te(o.ellipse),i=r.rx,a=r.ry,u=o.env.image,c=u.naturalWidth,l=u.naturalHeight,s=t(n.x-o.grabbedAt.x,c-i),f=t(n.y-o.grabbedAt.y,l-a);o.setSize(s,f,i,a),o.emit("update",Y(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),d=p<2?o.handles[p+2]:o.handles[p-2],y=o.handles[(p+3)%4];o.stretchCorners(p,d,y,n),o.emit("update",Y(o.ellipse,o.env.image))}}})),$e(We(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),$e(We(o),"updateState",(function(e){var t=X(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("rx")),a=parseFloat(t.getAttribute("ry"));o.setSize(n,r,i,a)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.ellipse=q(e),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new He(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=Te(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(e){var t=qe(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),fe(o.ellipse,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ze(Ze(u.prototype),"destroy",this).call(this)}}])&&Fe(t.prototype,n),u}(ue);function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t){return et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e,t){if(t&&("object"===Je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return nt(e)}function nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rt(e){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rt(e)}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rt(r);if(o){var n=rt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return tt(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),ot(nt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Ue(e,t,r.g,r.env)})),ot(nt(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),ot(nt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),ot(nt(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),ot(nt(r),"createEditableShape",(function(e){return new Ke(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Qe(t.prototype,n),a}(B);function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}it.identifier="ellipse",it.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var lt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ct(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),ct(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),ct(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),ct(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return at(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return at(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?at(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),ct(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),ct(this,"toSelection",(function(){return new j(Y(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.freehand}}])&&ut(t.prototype,n),e}();function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pt(e,t){return pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pt(e,t)}function dt(e,t){if(t&&("object"===st(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return yt(e)}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e,t,n){return bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},bt(e,t,n||e)}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ht(e)}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vt=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},mt=function(e){return e.querySelector(".a9s-inner").getBBox()},wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ht(r);if(o){var n=ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return dt(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),gt(yt(c=a.call(this,e,t,n,r)),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,u=o.width,l=o.height;pe(c.elementGroup,i,a,u,l)})),gt(yt(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),gt(yt(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e),r=mt(c.shape),o=r.x,i=r.y,a=r.width,u=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),d=t(i,n.y-c.grabbedAt.y,f-u),y=c.shape.querySelector(".a9s-inner"),b=vt(y).map((function(e){return{x:e.x+p,y:e.y+d}}));c.grabbedAt=n,c.setPoints(b),c.emit("update",Y(c.shape,c.env.image))}}})),gt(yt(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),gt(yt(c),"updateState",(function(e){var t=vt(X(e));c.setPoints(t)})),gt(yt(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),bt((o=yt(c),ht(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=q(e),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),fe(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=mt(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&ft(t.prototype,n),u}(ue);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function Et(e,t){if(t&&("object"===St(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return jt(e)}function jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e){return Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pt(e)}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pt(r);if(o){var n=Pt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Et(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),xt(jt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new lt([e,t],r.g,r.env)})),xt(jt(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),xt(jt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),xt(jt(r),"onMouseUp",(function(e,t){r.onDblClick(e,t)})),xt(jt(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,a=r.config.minSelectionWidth||4,u=r.config.minSelectionHeight||4;if(o>=a||i>=u){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),xt(jt(r),"createEditableShape",(function(e){return new wt(e,r.g,r.config,r.env)})),r._isDrawing=!1,r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Ot(t.prototype,n),a}(B);function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}kt.identifier="freehand",kt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return(null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<path*/g))&&!n.value.toUpperCase().includes("Z")};var Rt=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Mt(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.polygon.getAttribute("points")," z"))})),Mt(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.polygon=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.polygon.getAttribute("points")," z"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Ct(t.prototype,n),e}();function _t(e){return function(e){if(Array.isArray(e))return Dt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Tt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Tt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Tt(e,t){if(e){if("string"==typeof e)return Dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dt(e,t):void 0}}function Dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Lt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ht(this,"setPoints",(function(e){var t,n="",r=Gt(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a="";if(i.length>0){var u,c=Gt(i);try{for(c.s();!(u=c.n()).done;){var l=u.value;l&&(a+=""===a?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=a}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),Ht(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Ht(this,"dragTo",(function(e){o.group.style.display=null;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(_t(t),[e,t[0]]);n.push(r),o.setPoints(n),o.mask.redraw()})),Ht(this,"addPoint",(function(e){if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(_t(t),[e,t[0]]),o.setPoints(o.points),o.mask.redraw())}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),Ht(this,"undo",(function(){console.log("last",o.points[o.points.length-1].length),o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),Ht(this,"newPart",(function(){o.points.push([])})),Ht(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),Ht(this,"toSelection",(function(){return new j(Y(o.group,o.env.image))})),this.points=[],this.points.push([t,t]),this.env=r,this.group=document.createElementNS(i,"g"),this.multipolygon=document.createElementNS(i,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Rt(r.image,this.inner),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.multipolygon),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.multipolygon}}])&&Nt(t.prototype,n),e}();function Bt(e){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bt(e)}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xt(e,t){return Xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Xt(e,t)}function qt(e,t){if(t&&("object"===Bt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Yt(e)}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ft(e,t,n){return Ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},Ft(e,t,n||e)}function zt(e){return zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},zt(e)}function Vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function It(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zt=function(e){var t,n=[],r=It($t(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=[],u=It(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};a.push(l)}}catch(e){u.e(e)}finally{u.f()}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n},$t=function(e){var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},Kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xt(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=zt(r);if(o){var n=zt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return qt(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Vt(Yt(c=a.call(this,e,t,n,r)),"setPoints",(function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=It(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,u=!0,l=It(i);try{for(l.s();!(a=l.n()).done;){var s=a.value;u?(u=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(e){l.e(e)}finally{l.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}c.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=c.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),d=p.x,y=p.y,b=p.width,h=p.height;pe(c.elementGroup,d,y,b,h)})),Vt(Yt(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),Vt(Yt(c),"onMouseMove",(function(e){var t;c.grabbedElem&&(t=c.getSVGPoint(e),c.grabbedElem===c.shape?function(){var e,n=t.x-c.grabbedAt.x,r=t.y-c.grabbedAt.y,o=[],i=It(Zt(c.shape));try{for(i.s();!(e=i.n()).done;){var a=e.value;o.push(a.map((function(e){return{x:e.x+n,y:e.y+r}})))}}catch(e){i.e(e)}finally{i.f()}c.grabbedAt=t,c.setPoints(o);for(var u=0,l=0,s=o;l<s.length;l++)s[l].forEach((function(e,t){return c.setHandleXY(c.handles[u][t],e.x,e.y)})),u+=1;c.emit("update",Y(c.shape,c.env.image))}():function(){var e,n=-1,r=0,o=!1,i=It(c.handles);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.indexOf(c.grabbedElem)>0?(n=a.indexOf(c.grabbedElem),o=!0):o||(r+=1)}}catch(e){i.e(e)}finally{i.f()}var u,l=Zt(c.shape),s=[],f=0,p=It(l);try{for(p.s();!(u=p.n()).done;){var d=u.value;f===r?function(){var e=[];d.forEach((function(r,o){o===n?e.push(t):e.push(r)})),s.push(e)}():s.push(d),f+=1}}catch(e){p.e(e)}finally{p.f()}c.setPoints(s),f=0;var y,b=It(c.handles);try{for(b.s();!(y=b.n()).done;){var h=y.value;f===r&&c.setHandleXY(h[n],t.x,t.y),f+=1}}catch(e){b.e(e)}finally{b.f()}c.emit("update",Y(c.shape,c.env.image))}())})),Vt(Yt(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),Vt(Yt(c),"updateState",(function(e){var t=Zt(X(e));c.setPoints(t)})),Vt(Yt(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Ft((o=Yt(c),zt(u.prototype)),"destroy",o).call(o)})),console.log("editableMultipolygon initiated."),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=function(e){var t=X(e);!function(e){var t=X(e).getAttribute("d");$t(t)}(e);var n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),console.log("g",n),n}(e),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape);var l=Zt(c.shape);c.handles=[];var s,f=It(l);try{for(f.s();!(s=f.n()).done;){var p=s.value;c.handles.push(p.map((function(e){var t=c.drawHandle(e.x,e.y);return t.addEventListener("mousedown",c.onGrab(t)),c.elementGroup.appendChild(t),t})))}}catch(e){f.e(e)}finally{f.f()}c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),fe(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var d,y=(d=c.shape,console.log("we are here ",d.querySelector(".a9s-inner")),d.querySelector(".a9s-inner").getBBox());return y.x,y.y,y.width,y.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Ut(t.prototype,n),u}(ue);function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function en(e,t){return en=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},en(e,t)}function tn(e,t){if(t&&("object"===Jt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return nn(e)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rn(e){return rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rn(e)}function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var an=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&en(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rn(r);if(o){var n=rn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return tn(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),on(nn(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Lt([e,t],r.g,r.env)})),on(nn(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),on(nn(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),on(nn(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),on(nn(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),on(nn(r),"onMouseUp",(function(e,t,n){if(console.log("mouse up",n),n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect(),i=o.width,a=o.height,u=r.config.minSelectionWidth||4,c=r.config.minSelectionHeight||4;i>=u||a>=c?r.rubberband.addPoint([e,t]):(r.emit("cancel"),r.stop())}})),on(nn(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]);var n=r.rubberband.element;n.annotation=r.rubberband.toSelection(),r.emit("complete",n),r.stop()})),on(nn(r),"createEditableShape",(function(e){return new Kt(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){console.log("keyDown Driggered",e),"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&(console.log("n recognized"),r.newPart())})),r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Qt(t.prototype,n),a}(B);an.identifier="multipolygon",an.supports=function(e){var t,n;console.log("supports started");var r=e.selector("SvgSelector");if(console.log("selector",r),console.log(null===(t=r.value)||void 0===t?void 0:t.match(/^<svg.*<path d=/g)),r)return null===(n=r.value)||void 0===n?void 0:n.match(/^<svg.*<path d=/g)};var un=new Set(["circle","ellipse","freehand","multipolygon"]);const cn=function(e,t){var n=null!=t&&t.tools?new Set(t.tools.map((function(e){return e.toLowerCase()}))):un;n.has("circle")&&e.addDrawingTool(Re),n.has("ellipse")&&e.addDrawingTool(it),n.has("freehand")&&e.addDrawingTool(kt),n.has("multipolygon")&&e.addDrawingTool(an)}})(),r.default})()}));
//# sourceMappingURL=annotorious-selector-pack.min.js.map